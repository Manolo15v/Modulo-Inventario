<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Repuestos</title>
    
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="../css/styles.css">
  <meta charset="UTF-8">
  <style>
     /* Optional: Custom styles for the cards */
        .dashboard-card {
            transition: transform .2s;
        }
        .dashboard-card:hover {
            transform: scale(1.03);
        }
        .dashboard-card .card-body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px; /* Adjust as needed */
        }
        .dashboard-card .card-title {
            margin-top: 10px;
            font-size: 1.1rem;
        }
        .dashboard-card i {
            font-size: 2rem; /* Icon size */
            color: #007bff; /* Icon color */
        }
        .action-btn {
            width: 40px;
            height: 40px;
            margin: 0 2px;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
        }
        .view-btn {
            background-color: #17a2b8;
        }
        .edit-btn {
            background-color: #ffc107;
        }
        .delete-btn {
            background-color: #dc3545;
        }

        a.card-link {
            text-decoration: none;
            color: inherit;
        }
        a.card-link:hover {
            text-decoration: none;
            color: inherit;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .custom-toast {
            min-width: 250px;
        }
  </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row" >
            <nav class="col-md-2 d-none d-md-block sidebar">
                <h2>CRM Hospital</h2>
                 <ul>
                    <li><a href="/"><i class="fas fa-home"></i> Inicio</a></li> <!-- Link to root -->
                    <li><a href="#"><i class="fas fa-users"></i> Gestión de Personal</a></li>
                    <li><a href="#"><i class="fas fa-vial"></i> Laboratorio</a></li>
                    <!-- Updated Inventario link to point to the main index which now serves as dashboard -->
                    <li><a href="/" class="active"><i class="fas fa-boxes"></i> Inventario</a></li>
                    <li><a href="#"><i class="fas fa-shopping-cart"></i> Compras</a></li>
                    <li><a href="#"><i class="fas fa-tooth"></i> Consultas Odontológicas</a></li>
                    <li><a href="#"><i class="fas fa-stethoscope"></i> Consultas Médicas</a></li>
                    <li><a href="#"><i class="fas fa-file-invoice-dollar"></i> Administración</a></li>
                    <li><a href="#"><i class="fas fa-procedures"></i> Hospitalización</a></li>
                    <li><a href="#"><i class="fas fa-tools"></i> Mantenimiento</a></li>
                    <li><a href="#"><i class="fas fa-calendar-check"></i> Gestión de Citas</a></li>
                </ul>
                <div class="bottom-links">
                    <ul>
                        <li><a href="#"><i class="fas fa-question-circle"></i> Help</a></li>
                    </ul>
                </div>
            </nav>

            <main class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                <h1 class="mb-4 mt-4">Gestión de Equipos</h1>

                <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#equipoModal"
                  onclick="prepareNewEquipo()">
                  <i class="fas fa-plus"></i> Registrar Modelo
                </button>
            

                <button class="btn btn-primary mb-4" data-bs-toggle="modal" data-bs-target="#equipoModal"
                  onclick="prepareNewEquipo()">
                  <i class="fas fa-plus"></i> Nuevo Equipo
                </button>
            
                <div class="search-container">
                  <input type="text" id="searchInput" class="form-control" placeholder="Buscar Equipos..."
                    onkeyup="searchEquipos()">
                  <button class="search-btn" onclick="searchEquipos()">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
            
                <div class="card">
                    <div class="card-header">
                        <h2>Equipos</h2>
                        <p>Gestione todos los equipos.</p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr class="table-header">
                                    <th>Nombre</th>
                                    <th>Marca</th>
                                    <th>Modelo</th>
                                    <th>Frecuencia del mantenimiento</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                                </thead>
                                <tbody id="equiposTableBody">
                                <!-- Los datos se cargarán aquí dinámicamente -->
                                <tr>
                                    <td colspan="6" class="empty-message">No hay equipos disponibles</td>
                                </tr>
                                </tbody>
                            </table>
                            <button class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#equipoModal"
                            onclick="prepareNewEquipo()">
                            <i class="fas fa-plus"></i> Nuevo Equipo
                            </button>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
  <!-- Modal para Añadir/Editar Equipo -->
  <div class="modal fade" id="equipoModal" tabindex="-1" aria-labelledby="equipoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="equipoModalLabel">Nuevo Equipo</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="equipoForm">
            <input type="hidden" id="equipoId" value="">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="modeloSelect" class="form-label">Modelo de Equipo</label>
                <select class="form-select" id="modeloSelect" required>
                  <option value="" disabled selected>Seleccione un modelo</option>
                  <!-- Los modelos se cargarán dinámicamente -->
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="ubicacionSelect" class="form-label">Ubicación</label>
                <select class="form-select" id="ubicacionSelect" required>
                  <option value="" disabled selected>Seleccione una ubicación</option>
                  <!-- Las ubicaciones se cargarán dinámicamente -->
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="numeroSerieInput" class="form-label">Número de Serie</label>
                <input type="text" class="form-control" id="numeroSerieInput" required placeholder="Ej: SN123456789">
              </div>
              <div class="col-md-6 mb-3">
                <label for="estadoSelect" class="form-label">Estado</label>
                <select class="form-select" id="estadoSelect" required>
                  <option value="" disabled selected>Seleccione un estado</option>
                  <option value="Activo">Activo</option>
                  <option value="Inactivo">Inactivo</option>
                  <option value="En Mantenimiento">En Mantenimiento</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="fechaInstalacionInput" class="form-label">Fecha de Instalación</label>
                <input type="date" class="form-control" id="fechaInstalacionInput" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="frecuenciaInput" class="form-label">Frecuencia de Mantenimiento (días)</label>
                <input type="number" class="form-control" id="frecuenciaInput" required min="1" placeholder="Ej: 30">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success" onclick="saveEquipo()">
            <i class="fas fa-save me-1"></i> Guardar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Ver Detalles de Equipo -->
  <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="viewModalLabel">Detalles del Equipo</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title" id="viewNombre"></h5>
              <p class="card-text"><strong>ID:</strong> <span id="viewId"></span></p>
              <p class="card-text"><strong>Marca:</strong> <span id="viewMarca"></span></p>
              <p class="card-text"><strong>Modelo:</strong> <span id="viewModelo"></span></p>
              <p class="card-text"><strong>Número de Serie:</strong> <span id="viewNumeroSerie"></span></p>
              <p class="card-text"><strong>Estado:</strong> <span id="viewEstado"></span></p>
              <p class="card-text"><strong>Fecha de Instalación:</strong> <span id="viewFechaInstalacion"></span></p>
              <p class="card-text"><strong>Frecuencia de Mantenimiento (días):</strong> <span
                  id="viewFrecuencia"></span></p>
              <p class="card-text"><strong>Ubicación:</strong> <span id="viewUbicacion"></span></p>
              <p class="card-text"><strong>Área:</strong> <span id="viewArea"></span></p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación para Eliminar Equipo -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Esta acción no se puede deshacer.
          </div>
          <p>¿Está seguro que desea eliminar este equipo?</p>
          <p><strong>Nombre:</strong> <span id="deleteNombre"></span></p>
          <p><strong>Número de Serie:</strong> <span id="deleteNumeroSerie"></span></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-danger" onclick="confirmDelete()">
            <i class="fas fa-trash me-1"></i> Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenedor para las notificaciones toast -->
  <div class="toast-container"></div>

  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Variables globales
    let equipos = [];
    let modelos = [];
    let ubicaciones = [];
    let currentEquipoId = null;

    const apiUrlEquipo = '/api/inventario/equipos';
    const apiUrlModelo = '/api/inventario/modeloEquipos';
    const apiUrlUbicacion = '/api/inventario/almacen';

    // Cargar datos al iniciar la página
    document.addEventListener('DOMContentLoaded', async function () {

      await loadModelos();
      await loadUbicaciones();
      await loadEquipos();
    });

    // Función para cargar los modelos de equipos
    async function loadModelos() {
      try {
        const response = await fetch(apiUrlModelo);
        if (!response.ok) {
          throw new Error('Error al cargar los modelos de equipos');
        }
        modelos = await response.json();

        // Si la respuesta es un objeto único, convertirlo en array
        if (!Array.isArray(modelos)) {
          modelos = [modelos];
        }

        populateModelosSelect();
      } catch (error) {
        console.error('Error:', error);
        showToast('Error al cargar los modelos de equipos.', 'danger');

        populateModelosSelect();
      }
    }

    // Función para cargar las ubicaciones
    async function loadUbicaciones() {
      try {
        const response = await fetch(apiUrlUbicacion);
        if (!response.ok) {
          throw new Error('Error al cargar las ubicaciones');
        }
        ubicaciones = await response.json();

        // Si la respuesta es un objeto único, convertirlo en array
        if (!Array.isArray(ubicaciones)) {
          ubicaciones = [ubicaciones];
        }

        populateUbicacionesSelect();
      } catch (error) {
        console.error('Error:', error);
        showToast('Error al cargar las ubicaciones. Usando datos de ejemplo.', 'danger');

        // Datos de ejemplo en caso de error
        ubicaciones = [
          { Id_Ubicacion: 1, Area: "Laboratorio", Ubicacion: "Estante 3-B" },
          { Id_Ubicacion: 2, Area: "Quirófano", Ubicacion: "Sala 1" },
          { Id_Ubicacion: 3, Area: "Radiología", Ubicacion: "Sala Principal" },
          { Id_Ubicacion: 4, Area: "Consulta", Ubicacion: "Consultorio 5" }
        ];
        populateUbicacionesSelect();
      }
    }

    // Función para cargar los equipos desde la API
    async function loadEquipos() {
      try {
        const response = await fetch(apiUrlEquipo);
        if (!response.ok) {
          throw new Error('Error al cargar los datos de equipos');
        }
        equipos = await response.json();

        // Si la respuesta es un objeto único, convertirlo en array
        if (!Array.isArray(equipos)) {
          equipos = [equipos];
        }

        renderEquipos(equipos);
      } catch (error) {
        console.error('Error:', error);
        showToast('Error al cargar los datos. No hay equipos disponibles.', 'danger');

        // Dejar equipos como un array vacío
        equipos = [];
        renderEquipos(equipos);
      }
    }

    // Función para llenar el select de modelos
    function populateModelosSelect() {
      const select = document.getElementById('modeloSelect');
      // Limpiar opciones existentes excepto la primera
      while (select.options.length > 1) {
        select.remove(1);
      }

      // Añadir los modelos al select
      modelos.forEach(modelo => {
        const option = document.createElement('option');
        option.value = modelo.Id_Modelo;
        option.textContent = `${modelo.Nombre} (${modelo.Marca} - ${modelo.Modelo})`;
        select.appendChild(option);
      });
    }

    // Función para llenar el select de ubicaciones
    function populateUbicacionesSelect() {
      const select = document.getElementById('ubicacionSelect');
      // Limpiar opciones existentes excepto la primera
      while (select.options.length > 1) {
        select.remove(1);
      }

      // Añadir las ubicaciones al select
      ubicaciones.forEach(ubicacion => {
        const option = document.createElement('option');
        option.value = ubicacion.Id_Ubicacion;
        option.textContent = `${ubicacion.Area} - ${ubicacion.Ubicacion}`;
        select.appendChild(option);
      });
    }

    // Función para renderizar los equipos en la tabla
    function renderEquipos(data) {
      const tableBody = document.getElementById('equiposTableBody');
      tableBody.innerHTML = '';

      if (data.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = `
                    <td colspan="6" class="empty-message">No hay equipos disponibles</td>
                `;
        tableBody.appendChild(row);
        return;
      }

      data.forEach(equipo => {
        // Determinar la clase CSS para el estado
        let estadoClass = '';
        switch (equipo.Estado.toLowerCase()) {
          case 'activo':
            estadoClass = 'status-activo';
            break;
          case 'inactivo':
            estadoClass = 'status-inactivo';
            break;
          case 'en mantenimiento':
            estadoClass = 'status-mantenimiento';
            break;
          default:
            estadoClass = '';
        }

        const row = document.createElement('tr');
        row.innerHTML = `
                    <td>${equipo.Nombre_Modelo}</td>
                    <td>${equipo.Marca}</td>
                    <td>${equipo.Modelo}</td>
                    <td>${equipo.Frecuencia_mantenimiento} días</td>
                    <td><span class="status-badge ${estadoClass}">${equipo.Estado}</span></td>
                    <td>
                        <div class="action-btn view-btn" onclick="viewEquipo(${equipo.Id_Equipo})" title="Ver detalles">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="action-btn edit-btn" onclick="editEquipo(${equipo.Id_Equipo})" title="Editar">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="action-btn delete-btn" onclick="deleteEquipo(${equipo.Id_Equipo})" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </div>
                    </td>
                `;
        tableBody.appendChild(row);
      });
    }

    // Función para buscar equipos
    function searchEquipos() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      // Filtrar equipos basados en nombre, marca, modelo, estado, etc.
      const filteredEquipos = equipos.filter(equipo =>
        equipo.Nombre_Modelo.toLowerCase().includes(searchTerm) ||
        equipo.Marca.toLowerCase().includes(searchTerm) ||
        equipo.Modelo.toLowerCase().includes(searchTerm) ||
        equipo.Estado.toLowerCase().includes(searchTerm) ||
        equipo.Frecuencia_mantenimiento.toString().includes(searchTerm) ||
        equipo.Numero_de_serie.toLowerCase().includes(searchTerm) ||
        equipo.Area.toLowerCase().includes(searchTerm) ||
        equipo.Ubicacion.toLowerCase().includes(searchTerm)
      );

      renderEquipos(filteredEquipos);
    }

    // Función para preparar el modal para un nuevo equipo
    function prepareNewEquipo() {
      document.getElementById('equipoModalLabel').textContent = 'Nuevo Equipo';
      document.getElementById('equipoForm').reset();
      document.getElementById('equipoId').value = '';
      currentEquipoId = null;

      // Establecer la fecha máxima como hoy
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('fechaInstalacionInput').max = today;

      // Enfoca el primer campo después de que el modal se muestre
      document.getElementById('equipoModal').addEventListener('shown.bs.modal', function () {
        document.getElementById('modeloSelect').focus();
      }, { once: true });
    }

    // Función para ver detalles de un equipo
    function viewEquipo(id) {
      const equipo = equipos.find(e => e.Id_Equipo === id);
      if (equipo) {
        // Formatear la fecha de instalación
        const fechaInstalacion = new Date(equipo.Fecha_Instalacion);
        const fechaFormateada = fechaInstalacion.toISOString().split('T')[0];

        document.getElementById('viewId').textContent = equipo.Id_Equipo;
        document.getElementById('viewNombre').textContent = equipo.Nombre_Modelo;
        document.getElementById('viewMarca').textContent = equipo.Marca;
        document.getElementById('viewModelo').textContent = equipo.Modelo;
        document.getElementById('viewNumeroSerie').textContent = equipo.Numero_de_serie;
        document.getElementById('viewEstado').textContent = equipo.Estado;
        document.getElementById('viewFechaInstalacion').textContent = fechaFormateada;
        document.getElementById('viewFrecuencia').textContent = equipo.Frecuencia_mantenimiento;
        document.getElementById('viewUbicacion').textContent = equipo.Ubicacion;
        document.getElementById('viewArea').textContent = equipo.Area;

        const viewModal = new bootstrap.Modal(document.getElementById('viewModal'));
        viewModal.show();
      }
    }

    // Función para editar un equipo
    function editEquipo(id) {
      const equipo = equipos.find(e => e.Id_Equipo === id);
      if (equipo) {
        document.getElementById('equipoModalLabel').textContent = 'Editar Equipo';
        document.getElementById('equipoId').value = equipo.Id_Equipo;
        document.getElementById('modeloSelect').value = equipo.Id_Modelo;
        document.getElementById('ubicacionSelect').value = equipo.Id_Ubicacion;
        document.getElementById('numeroSerieInput').value = equipo.Numero_de_serie;
        document.getElementById('estadoSelect').value = equipo.Estado;
        document.getElementById('frecuenciaInput').value = equipo.Frecuencia_mantenimiento;

        // Formatear la fecha de instalación para el input date
        const fechaInstalacion = new Date(equipo.Fecha_Instalacion);
        const fechaFormateada = fechaInstalacion.toISOString().split('T')[0];
        document.getElementById('fechaInstalacionInput').value = fechaFormateada;

        currentEquipoId = equipo.Id_Equipo;

        const equipoModal = new bootstrap.Modal(document.getElementById('equipoModal'));
        equipoModal.show();
      }
    }

    // Función para eliminar un equipo
    function deleteEquipo(id) {
      const equipo = equipos.find(e => e.Id_Equipo === id);
      if (equipo) {
        document.getElementById('deleteNombre').textContent = equipo.Nombre_Modelo;
        document.getElementById('deleteNumeroSerie').textContent = equipo.Numero_de_serie;
        currentEquipoId = equipo.Id_Equipo;

        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        deleteModal.show();
      }
    }

    // Función para confirmar la eliminación
    async function confirmDelete() {
      if (currentEquipoId) {
        try {
          const deleteUrl = `${apiUrlEquipo}/${currentEquipoId}`;
          console.log(`Eliminando equipo con ID ${currentEquipoId}. URL: ${deleteUrl}`);

          const response = await fetch(deleteUrl, {
            method: 'DELETE'
          });

          if (!response.ok) {
            throw new Error(`Error al eliminar el equipo: ${response.status} ${response.statusText}`);
          }

          console.log(`Equipo con ID ${currentEquipoId} eliminado correctamente`);

          // Eliminar de la lista local
          equipos = equipos.filter(e => e.Id_Equipo !== currentEquipoId);
          renderEquipos(equipos);

          // Cerrar el modal
          const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
          deleteModal.hide();

          // Mostrar mensaje de éxito
          showToast('Equipo eliminado con éxito', 'success');
        } catch (error) {
          console.error('Error:', error);
          showToast('Error al eliminar el equipo: ' + error.message, 'danger');

          // Cerrar el modal
          const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
          deleteModal.hide();
        }
      }
    }

    // Función para guardar un equipo (crear o actualizar)
    async function saveEquipo() {
      const modeloId = parseInt(document.getElementById('modeloSelect').value);
      const ubicacionId = parseInt(document.getElementById('ubicacionSelect').value);
      const numeroSerie = document.getElementById('numeroSerieInput').value.trim();
      const estado = document.getElementById('estadoSelect').value;
      const fechaInstalacion = document.getElementById('fechaInstalacionInput').value;
      const frecuenciaMantenimiento = parseInt(document.getElementById('frecuenciaInput').value);

      if (isNaN(modeloId) || isNaN(ubicacionId) || !numeroSerie || !estado || !fechaInstalacion || isNaN(frecuenciaMantenimiento)) {
        showToast('Por favor complete todos los campos correctamente', 'warning');
        return;
      }

      try {
        let url = apiUrlEquipo;
        let method = 'POST';
        let equipoData;

        // Si es una edición, usamos PUT y la URL con ID, manteniendo la estructura original
        if (currentEquipoId) {
          url = `${apiUrlEquipo}/${currentEquipoId}`;
          method = 'PUT';

          // Estructura original para PUT
          equipoData = {
            Fecha_Instalacion: fechaInstalacion,
            Estado: estado,
            Frecuencia_mantenimiento: frecuenciaMantenimiento,
            Numero_de_serie: numeroSerie,
            Id_Modelo: modeloId,
            Id_Ubicacion: ubicacionId
          };
        } else {
          // Estructura nueva para POST
          equipoData = {
            FechaInstalacion: fechaInstalacion,
            Estado: estado,
            FrecuenciaMantenimiento: frecuenciaMantenimiento,
            NumeroDeSerie: numeroSerie,
            idModelo: modeloId,
            idUbicacion: ubicacionId
          };
        }

        console.log(`Enviando datos a ${url} con método ${method}:`, equipoData);

        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(equipoData)
        });

        if (!response.ok) {
          throw new Error(`Error al guardar el equipo: ${response.status} ${response.statusText}`);
        }

        const responseData = await response.json();
        console.log('Respuesta del servidor:', responseData);

        // Recargar los datos
        await loadEquipos();

        // Cerrar el modal
        const equipoModal = bootstrap.Modal.getInstance(document.getElementById('equipoModal'));
        equipoModal.hide();

        // Mostrar mensaje de éxito
        showToast(currentEquipoId ? 'Equipo actualizado con éxito' : 'Equipo creado con éxito', 'success');
      } catch (error) {
        console.error('Error:', error);
        showToast('Error al guardar el equipo: ' + error.message, 'danger');

        // Cerrar el modal
        const equipoModal = bootstrap.Modal.getInstance(document.getElementById('equipoModal'));
        equipoModal.hide();
      }
    }

    // Función para mostrar notificaciones toast
    function showToast(message, type = 'success') {
      const toastContainer = document.querySelector('.toast-container');

      // Crear el elemento toast
      const toastElement = document.createElement('div');
      toastElement.className = `toast custom-toast align-items-center text-white bg-${type} border-0`;
      toastElement.setAttribute('role', 'alert');
      toastElement.setAttribute('aria-live', 'assertive');
      toastElement.setAttribute('aria-live', 'assertive');
      toastElement.setAttribute('aria-atomic', 'true');

      // Crear el contenido del toast
      const toastContent = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;

      toastElement.innerHTML = toastContent;
      toastContainer.appendChild(toastElement);

      // Inicializar y mostrar el toast
      const toast = new bootstrap.Toast(toastElement, {
        autohide: true,
        delay: 5000
      });

      toast.show();

      // Eliminar el toast del DOM después de ocultarse
      toastElement.addEventListener('hidden.bs.toast', function () {
        toastElement.remove();
      });
    }
  </script>
</body>

</html>